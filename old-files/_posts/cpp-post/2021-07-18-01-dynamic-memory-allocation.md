---
title: "[C++] 포인터와 동적 할당"
excerpt: "메모리의 동적 할당에 대해 알아보자"

categories:
  - Cpp
tags:
  - [Cpp, 포인터, 동적 할당]

toc: true
toc_sticky: true

last_modified_at: 2021-07-18
---

메모리 할당은 크게 세가지로 분류할 수 있다.

* 정적(`static`) 메모리 : 프로그램이 실행될 때, 한 번만 할당되며 프로그램이 종료될 때 해제된다. (정적 변수, 전역 변수, ...)

* 자동(`auto`) 메모리 : 범위 {}로 묶인 곳에서 할당되며 범위를 벗어나면 해제된다. (함수의 매개변수, 지역 변수, ...)

* 동적(`dynamic`) 메모리 : 필요한 메모리를 운영체제에 요청하는 방법으로 <mark style="background-color: #3e3e3e; color: #8A3DB6;">스택(stack)</mark>이 아닌 <mark style="background-color: #3e3e3e; color: #8A3DB6;">힙(heep)</mark>이라는 영역에서 할당된다. (힙 영역의 크기가 스택의 영역보다 훨씬 크다.)

정적 및 자동 메모리는 변수와 배열의 크기를 `컴파일 타임`에 알아야하고,   
메모리의 할당과 해제가 자동으로 수행된다.   
하지만 동적 메모리는 힙 영역의 크기를 프로그램이 실행되는 `런 타임`에 결정하며,   
메모리의 할당과 해제를 개발자가 직접한다.

## 동적 할당의 장점

정적 및 자동 할당된 메모리의 경우, `컴파일 타임`에 미리 메모리를 할당하여 공간을 낭비하는 경우가 많다.   
하지만 동적 할당의 경우 프로그램의 실행중에 필요한 만큼 메모리를 할당하여 낭비를 최소화할 수 있다.

대신 동적 할당은 실행 도중에 할당을 받으므로 시간 지연 및 성능 저하를 유발할 수 있다.   
또한 개발자가 수동적으로 해제해 줘야 하는데, 해제하지 않을 경우 <mark style="background-color: #3e3e3e; color: orange;">메모리 누수</mark>가 일어날 수 있다.

## 단일 변수의 동적 할당

```cpp
Type *pointer = new Type(value);
```

C 언어에서의 동적 할당은 `malloc` 또는 `colloc` 메서드를 사용하여 동적 할당을 수행한다.   
하지만 C++ 언어에서는 그보다 편리한 `new` 연산자를 사용하여 동적 할당을 수행한다.

<mark style="background-color: #3e3e3e; color: #8A3DB6;">힙(heep)</mark> 영역에서 `new`연산자를 통해 자료형만큼의 메모리를 할당한다.   
이때 위치를 알 수 없는 메모리의 주소를 포인터로 가리키는 것이다.   
포인터 없이는 동적 할당을 사용할 수 없는 것이다.

동적 할당된 메모리에 저장된 값에 접근하는 것은 아래와 같이   
포인터의 역참조(`*`)를 통해 가능하다.

```cpp
int *ptr1 = new int(10);  // 직접 초기화
int *ptr2 = new int{10};  // 유니폼 초기화
```

만약 메모리가 부족하여 할당하지 못했다면, 널 포인터(`nullptr`)를 반환한다.   
(매우 드문 경우라고 한다.)

## 단일 변수의 해제

```cpp
delete pointer;
pointer = nullptr;  //  C++11 이전은 NULL
```

C 언어에서는 동적 할당된 메모리를 `free` 메서드를 사용하여 해제한다.   
C++ 언어에서는 `delete`연산자를 사용하여 메모리를 해제한다.

`new`연산자를 통해 할당된 변수만 `delete`연산자로 해제할 수 있으며,   
한번 해제된 메모리를 다시 해제하려고 하면 에러가 발생한다.   
또한 동적 할당된 변수가 아닌 변수를 `delete`연산자로 해제하려고 해도 에러가 발생한다.

`delete`연산자는 포인터가 가리키는 메모리를 운영체제로 반환한다.   
그로인해 운영체제는 다시 그 메모리를 사용할 수 있는 것이다.

## 메모리 누수 (Memory Leak)

동적 할당된 메모리는 명시적으로 해제하거나 프로그램이 종료될 때까지 할당된 상태를 유지한다.

주의해야 하는 것은 포인터가 동적 할당된 메모리를 잃어버리는 상황이 생길 수 있는데,   
이때 한 번 잃어버린 메모리의 주소는 찾을 수 없고, 결국 해제할 수 없다는 것이다.

문제는 이 메모리를 해제해 주지 않으면   
운영체제는 프로그램이 종료될 때까지 이 메모리를 사용할 수 없게 된다.

이러한 것을 `메모리 누수`라고 한다.